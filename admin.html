<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>NeuroGallery -- Admin</title>
<style>
:root{
  --bg:#0b0e13; --card:#151a22; --text:#e5e9ec; --muted:#a8b0ba;
  --accent:#00eaff; --gold:#ffd166; --border:rgba(0,234,255,.18);
  --ok:#19d18a; --bad:#ff5c5c;
}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Arial,sans-serif}
header{max-width:1200px;margin:0 auto;padding:16px;display:flex;gap:12px;align-items:center;justify-content:space-between}
h1{margin:0;color:var(--accent);text-shadow:0 0 10px var(--accent);font-size:1.2rem}
main{max-width:1200px;margin:0 auto 40px;padding:0 16px}
.statbar{background:rgba(21,26,34,.9);border:1px solid var(--border);border-radius:12px;padding:12px;margin-bottom:14px;display:flex;gap:14px;flex-wrap:wrap;align-items:center;justify-content:space-between}
.stat{background:rgba(255,255,255,.06);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;position:relative}
.card img{width:100%;height:180px;object-fit:cover}
.status-badge{position:absolute;top:8px;left:8px;padding:4px 8px;border-radius:6px;font-size:.75rem;font-weight:700}
.status-badge.pending{background:var(--bad);color:#fff}
.status-badge.approved{background:var(--ok);color:#000}
.meta{padding:10px} .small{color:var(--muted);font-size:.9rem}
.row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.btn{border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text);border-radius:8px;padding:8px 10px;font-weight:700;cursor:pointer}
.btn.main{background:var(--accent);color:#000;border:none}
.btn.ok{background:rgba(25,209,138,.15);border-color:rgba(25,209,138,.35)}
.btn.bad{background:rgba(255,92,92,.12);border-color:rgba(255,92,92,.35)}
footer{max-width:1200px;margin:20px auto 30px;color:#9aa4af;text-align:center}
.warn{color:var(--bad);font-weight:800}
</style>
</head>
<body>
<header>
  <h1>NeuroGallery -- Admin</h1>
  <div class="row">
    <button id="signBtn" class="btn main">Sign in with Google</button>
    <button id="approveAll" class="btn">Approve All</button>
  </div>
</header>

<main>
  <div class="statbar" id="stats"></div>
  <div id="warn" class="warn" style="text-align:center;margin-bottom:10px;"></div>
  <div class="grid" id="grid"></div>
</main>

<footer>Admin works with Firestore/Storage. Only ADMIN_EMAIL can approve/delete.</footer>

<script type="module">
import {
  auth, provider, signInWithPopup, signOut, onAuthStateChanged,
  db, storage,
  collection, query, orderBy, onSnapshot, updateDoc, deleteDoc, doc,
  deleteObject, ref
} from './firebase-config.js';

/* ---- CONFIG: set your admin email here ---- */
const ADMIN_EMAIL = "ingfin14@gmail.com"; // ← ЗАМІНИ НА СВІЙ GOOGLE E-MAIL

/* ---- UI ---- */
const signBtn = document.getElementById('signBtn');
const approveAllBtn = document.getElementById('approveAll');
const stats = document.getElementById('stats');
const grid = document.getElementById('grid');
const warn = document.getElementById('warn');

let isAdmin = false;
onAuthStateChanged(auth, (user)=>{
  if(user){
    signBtn.textContent = `Sign out (${user.email})`;
    isAdmin = (user.email === ADMIN_EMAIL);
    warn.textContent = isAdmin ? '' : 'You are not admin. Read-only mode.';
  }else{
    signBtn.textContent = 'Sign in with Google';
    isAdmin = false;
    warn.textContent = 'Not signed in.';
  }
});

signBtn.onclick = async ()=>{
  if(auth.currentUser){ await signOut(auth); return; }
  await signInWithPopup(auth, provider);
};

approveAllBtn.onclick = async ()=>{
  if(!isAdmin){ alert('Admin only'); return; }
  const cards = document.querySelectorAll('[data-id][data-status="pending"]');
  const ops = [];
  cards.forEach(c=>{
    const id = c.getAttribute('data-id');
    ops.push(updateDoc(doc(collection(db,'images'), id), { status:'approved' }));
  });
  await Promise.all(ops);
  alert('Approved all pending.');
};

/* ---- Live list ---- */
const q = query(collection(db,'images'), orderBy('createdAt','desc'));
onSnapshot(q, (snap)=>{
  const items = snap.docs.map(d=>({ id:d.id, ...d.data() }));
  render(items);
});

function render(items){
  const total = items.length;
  const pending = items.filter(it=>it.status==='pending').length;
  const approved = items.filter(it=>it.status==='approved').length;
  stats.innerHTML = `
    <div class="stat">Total: <b>${total}</b></div>
    <div class="stat">Approved: <b style="color:#19d18a">${approved}</b></div>
    <div class="stat">Pending: <b style="color:#ff5c5c">${pending}</b></div>
  `;
  grid.innerHTML = '';
  items.forEach(it=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-id', it.id);
    card.setAttribute('data-status', it.status||'approved');
    card.innerHTML = `
      <span class="status-badge ${it.status==='pending'?'pending':'approved'}">${it.status||'approved'}</span>
      <img src="${it.url}" alt="">
      <div class="meta">
        <div style="font-weight:800">${it.title||'Untitled'}</div>
        <div class="small">Cat: ${it.cat||'--'}</div>
        <div class="small">${(it.prompt||'').slice(0,120)}${(it.prompt||'').length>120?'…':''}</div>
        <div class="row">
          <button class="btn ok" data-act="approve">Approve</button>
          <button class="btn bad" data-act="delete">Delete</button>
        </div>
      </div>
    `;
    const approveBtn = card.querySelector('[data-act="approve"]');
    const delBtn = card.querySelector('[data-act="delete"]');
    approveBtn.onclick = ()=> approve(it);
    delBtn.onclick = ()=> remove(it);
    grid.appendChild(card);
  });
}

async function approve(it){
  if(!isAdmin){ alert('Admin only'); return; }
  await updateDoc(doc(collection(db,'images'), it.id), { status:'approved' });
}

async function remove(it){
  if(!isAdmin){ alert('Admin only'); return; }
  if(!confirm('Delete this image and file?')) return;
  try{
    // delete Firestore doc
    await deleteDoc(doc(collection(db,'images'), it.id));
    // delete Storage file (if path stored)
    if(it.storagePath){
      await deleteObject(ref(storage, it.storagePath));
    }
  }catch(e){
    alert('Delete failed: '+e.message);
  }
}
</script>
</body>
</html>y>
</html>t.status==='approved').length;
  const byCat = items.reduce((m,it)=>((m[it.cat]= (m[it.cat]||0)+1),m),{});
  statbar.innerHTML = `
    <div class="stat">Total: <b>${total}</b></div>
    <div class="stat">Approved: <b style="color:var(--ok)">${approved}</b></div>
    <div class="stat">Pending: <b style="color:var(--bad)">${pending}</b></div>
    ${Object.keys(byCat).map(c=>`<div class="stat">${c}: <b>${byCat[c]}</b></div>`).join('')}
  `;
}

/* Grid */
function renderGrid(){
  grid.innerHTML='';
  items.forEach((it,idx)=>{
    const el=document.createElement('div');
    el.className='card';
    el.innerHTML=`
      <span class="status-badge ${it.status==='pending'?'pending':'approved'}">${it.status}</span>
      <img src="${it.src}" alt="">
      <div class="meta">
        <div style="font-weight:800">${it.title||'Untitled'}</div>
        <div class="small">Cat: ${it.cat||'Unknown'}</div>
        <div class="small" title="${it.prompt||''}">${(it.prompt||'').slice(0,90)}${(it.prompt||'').length>90?'…':''}</div>
        <div class="row">
          <button class="btn ok" onclick="toggleStatus(${idx})">Toggle</button>
          <button class="btn bad" onclick="removeItem(${idx})">Delete</button>
        </div>
      </div>`;
    grid.appendChild(el);
  });
}

/* Actions */
window.toggleStatus=(i)=>{
  items[i].status = (items[i].status==='pending'?'approved':'pending');
  localStorage.setItem(LS_ITEMS, JSON.stringify(items));
  renderAll();
};
window.removeItem=(i)=>{
  if(!confirm('Delete this image?'))return;
  items.splice(i,1);
  localStorage.setItem(LS_ITEMS, JSON.stringify(items));
  renderAll();
};

/* Users */
function renderUsers(){
  usersBox.innerHTML='';
  const map={};
  items.forEach(it=>{
    const a=it.author||'Guest';
    map[a]=(map[a]||0)+1;
  });
  const keys=Object.keys(map);
  if(!keys.length){usersBox.innerHTML='<div class="small">No user data.</div>';return;}
  keys.sort((a,b)=>map[b]-map[a]).forEach(u=>{
    const row=document.createElement('div');
    row.className='kv';
    row.innerHTML=`<span>${u}</span><span><b>${map[u]}</b> uploads</span>`;
    usersBox.appendChild(row);
  });
}

/* Analytics */
function renderAnalytics(){
  anOverview.innerHTML='';
  const total=items.length;
  const approved=items.filter(it=>it.status==='approved').length;
  const pending=items.filter(it=>it.status==='pending').length;
  const byCat=items.reduce((m,it)=>((m[it.cat]= (m[it.cat]||0)+1),m),{});
  const box=document.createElement('div');
  box.className='box';
  box.innerHTML=`
    <div class="kv"><span>Total</span><b>${total}</b></div>
    <div class="kv"><span>Approved</span><b style="color:var(--ok)">${approved}</b></div>
    <div class="kv"><span>Pending</span><b style="color:var(--bad)">${pending}</b></div>
    ${Object.keys(byCat).map(c=>`<div class="kv"><span>${c}</span><b>${byCat[c]}</b></div>`).join('')}
  `;
  anOverview.appendChild(box);
}

/* Boot */
function boot(){
  items = JSON.parse(localStorage.getItem(LS_ITEMS) || '[]');
  renderAll();
}
</script>
</body>
</html>